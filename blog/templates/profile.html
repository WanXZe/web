{% extends "base.html" %}
{% block title %}{{ session['user-name'] }}的个人主页 - WanXZe's Blog{% endblock %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<p>用户名：{{ session['user-name'] }}</p>
{% if option == 1 %}
    {% if article %}
        <!-- 修改文章 -->
        <h3 style="margin-bottom: 1rem;">修改文章</h3>
        <form action="/update_article/{{article['id']}}" method="post" class="animate__animated animate__fadeIn">
            <div class="form-group">
                <label class="form-label">文章标题</label>
                <input type="hidden" id="author" name="author" value="{{session['user-name']}}">
                <input type="text" id="title" name="title" value="{{article['title']}}" class="form-control" placeholder="给你的文章起个吸引人的标题..." required>
            </div>
                        
            <div class="form-group">
                <label class="form-label">验证码</label>
                <div style="display: flex; gap: 1rem;">
                    <input type="text" name="captcha" class="form-control" placeholder="输入验证码" required>
                    <img src="/captcha" alt="验证码" onclick="this.src='/captcha?r='+Math.random()" 
                            style="height: 45px; border-radius: var(--radius-md); cursor: pointer;">
                </div>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> 发布文章</button>

            <div class="form-group">
                <label class="form-label">文章内容ps:丑是丑了一点但是好歹能用</label>
                <div class="display_container">
                    <div class="mdcontainer">
                        <textarea id="content" name="content" class="form-control" rows="50" placeholder="分享你的想法..." required>{{article['content']}}</textarea>
                    </div>
                    <div class="mdcontainer">
                        <div class="md_content" id="md_content">这里会显示你输入的markdown渲染效果哦</div>
                    </div>
                </div>
            </div>
        </form>

    {% else %}
        <!-- 发布文章 -->
            <h3 style="margin-bottom: 1rem;">发表文章</h3>
        <form action="/profile/1" method="post" class="animate__animated animate__fadeIn">
            <div class="form-group">
                <label class="form-label">文章标题</label>
                <input type="hidden" id="author" name="author" value="{{session['user-name']}}">
                <input type="text" id="title" name="title" class="form-control" placeholder="给你的文章起个吸引人的标题..." required>
            </div>
            
            <div class="form-group">
                <label class="form-label">验证码</label>
                <div style="display: flex; gap: 1rem;">
                    <input type="text" name="captcha" class="form-control" placeholder="输入验证码" required>
                    <img src="/captcha" alt="验证码" onclick="this.src='/captcha?r='+Math.random()" 
                            style="height: 45px; border-radius: var(--radius-md); cursor: pointer;">
                </div>
            </div>

            <button type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> 发布文章</button>
            
            <div class="form-group">
                <label class="form-label">文章内容<br/>ps:丑是丑了一点但是好歹能用</label>
                <br/>
                <div class="display_container">
                    <div class="mdcontainer">
                        <textarea id="content" name="content" class="form-control" rows="50" placeholder="分享你的想法..." required>请在这里输入数据</textarea>
                    </div>
                    <div class="mdcontainer">
                        <div class="md_content" id="md_content">这里会显示你输入的markdown渲染效果哦</div>
                    </div>
                </div>
            </div>
        </form>
{% endif %}
{% elif option == 2 %}
    <h3 style="margin-bottom: 1rem;">修改用户名</h3>
    <form action="/profile/2" method="POST" class="animate__animated animate__fadeIn">
        <div class="form-group">
            <input type="hidden" name="id" value="{{session['id']}}">
            <input type="text" name="new_name" class="form-control" placeholder="新用户名" required>
        </div>

        <div class="form-group">
            <label class="form-label">输入图像验证码</label>
            <div style="display: flex; gap: 1rem;">
                <input type="text" name="captcha" class="form-control" placeholder="输入验证码" required>
                <img src="/captcha" alt="验证码" onclick="this.src='/captcha?r='+Math.random()" style="height: 45px; border-radius: var(--radius-md); cursor: pointer;">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">修改用户名</button>
    </form>
{% endif %}
<p>{{error}}</p>
<style>
    .display_container{
        display: flex;
        width: 95%;
        height: 100%;
        margin: auto;
        box-sizing: border-box;
    }
    .mdcontainer{  
        margin: auto;
        width: 45%;
        height: 100%;
        /* border-color: black;
        border-width: 2px;
        border-style: solid; */
    }
    .mdcontainer textarea{
        width: 90%;
        height: 90%;
        resize: none;
        font-size: medium;
        padding: 2%;
        background-color: white;
        border-color: white;
        margin-right: auto;
        color: black;
        border: none;
        outline: none;
    }
    .md_content{
        width: 100%;
        height: 100%;
        font-size: medium;
        background-color: white;
        /* background-color: wheat; */
        white-space: pre-wrap;
        word-wrap: break-word;
        color: black;
    }
</style>
<script>
    var content = document.getElementById("content");
    var md_content = document.getElementById("md_content");
    content.addEventListener("input", function(){
        md_content.innerHTML = marked.parse(content.value);
    });
    window.isloaded = function(){
        md_content.innerHTML = marked.parse(content.value);
    }
</script>
{% endblock %}